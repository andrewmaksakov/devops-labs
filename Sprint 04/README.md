# Sprint 04 — Диски, файловые системы, бэкапы и восстановление

**Цель:** защитить данные и уметь восстановиться

**Длительность:** 2 недели

---

## Теория

### Основные термины

| Термин | Что это |
|--------|--------|
| Диск | Физическое устройство для хранения данных (HDD, SSD) |
| Файловая система | Способ организации данных на диске (ext4, NTFS, xfs) |
| Монтирование (mount) | Подключение диска к папке в системе |
| fstab | Файл `/etc/fstab`, говорит системе какие диски монтировать при загрузке |
| Page cache | Linux кеширует данные с диска в RAM. Первое чтение — медленно (диск), второе — быстро (RAM). После перезагрузки кеш пустой |
| SWAP | Раздел подкачки. Когда RAM не хватает, система сбрасывает данные на диск |

### Команды для работы с дисками

| Команда | Что делает |
|---------|-----------|
| `lsblk` | Список дисков и разделов (list block devices) |
| `df -h` | Сколько места занято/свободно на каждом диске (-h = human readable) |
| `du -sh <папка>` | Размер конкретной папки (-s = итого, -h = human readable) |
| `mount` | Показать что куда смонтировано / смонтировать диск |
| `cat /etc/fstab` | Посмотреть какие диски монтируются при загрузке |

### Команды для работы с архивами

| Команда | Что делает |
|---------|-----------|
| `tar -czf архив.tar.gz папка/` | Создать сжатый архив (-c create, -z gzip, -f file) |
| `tar -tzf архив.tar.gz` | Посмотреть содержимое архива (-t list) |
| `tar -xzf архив.tar.gz -C /куда/` | Распаковать архив (-x extract, -C куда) |

---

## Практические задания

### 1. Скрипт backup.sh

Архивирует конфиги (Nginx, systemd unit) + ротация (хранит 7 последних бэкапов).

### 2. Скрипт restore.sh

Восстанавливает конфиги из последнего бэкапа.

### 3. Учение

Удалить конфиги Nginx/юнит/данные сервиса → восстановить из бэкапа.

---

## Структура папки

```
Sprint 04/
├── README.md
├── scripts/
│   ├── backup.sh          # Архивирование + ротация
│   └── restore.sh         # Восстановление
└── troubleshooting.md     # Типовые проблемы
```

---

## Как использовать

```bash
# Создать бэкап
sudo bash scripts/backup.sh

# Посмотреть бэкапы
ls -lh /var/backups/myapp/

# Проверить содержимое бэкапа
tar -tzf /var/backups/myapp/backup-YYYYMMDD-HHMMSS.tar.gz

# Восстановить из последнего бэкапа
sudo bash scripts/restore.sh

# Восстановить из конкретного бэкапа
sudo bash scripts/restore.sh /var/backups/myapp/backup-20260217-120000.tar.gz
```

---

## Экзамен (самопроверка)

- [ ] Знаю что показывает `lsblk`, `df -h`, `du -sh`
- [ ] Могу создать бэкап и показать где он лежит
- [ ] Могу проверить размер и содержимое бэкапа
- [ ] Могу восстановить конфиги из бэкапа
- [ ] Могу объяснить что такое page cache
